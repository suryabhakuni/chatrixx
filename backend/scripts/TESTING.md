# Testing Chatrixx API with Firebase Authentication

This guide will help you test the Chatrixx API using Firebase Authentication.

## Prerequisites

- Node.js installed
- Firebase project set up
- Firebase Admin SDK credentials (firebase-config.json)
- Postman installed

## Step 1: Generate Test Tokens

1. Make sure your Firebase Admin SDK credentials are in the `firebase-config.json` file in the `backend/config` directory.

2. Run the token generator script:

```bash
cd backend
node scripts/generateTestToken.js
```

3. This will create test users in your Firebase project and generate custom tokens for them.

## Step 2: Exchange Custom Token for ID Token

Since Firebase requires a client-side SDK to exchange custom tokens for ID tokens, use the provided HTML tool:

1. Open `scripts/token-exchanger.html` in your browser.

2. In Step 1, enter your Firebase client configuration (from Firebase Console → Project Settings → Web App).

3. Click "Initialize Firebase".

4. In Step 2, paste the custom token generated by the script.

5. Click "Exchange for ID Token".

6. In Step 3, copy the ID token that will be used in your Postman requests.

## Step 3: Set Up Postman

1. Import the Postman collection:

   - Open Postman
   - Click "Import" → "File" → Select `scripts/Chatrixx_API_Tests.postman_collection.json`

2. Set up environment variables:

   - Create a new environment in Postman
   - Add the following variables:
     - `baseUrl`: `http://localhost:4000/api`
     - `firebaseToken`: Paste the ID token from Step 2

3. Select the environment you created.

## Step 4: Run the Tests

Now you can run the API tests in the collection:

1. Start with the Authentication tests:

   - Try "Google Login" or "Facebook Login" first
   - This will authenticate you with the test user

2. After successful login, you can test other endpoints:
   - User management
   - Conversations
   - Messages
   - etc.

## Important Notes

1. **Token Expiration**: Firebase ID tokens expire after 1 hour. If you get authentication errors, generate a new token.

2. **User IDs**: For endpoints that require user IDs (like creating conversations), you'll need to:

   - Create multiple test users, or
   - Get existing user IDs from your database, or
   - Set the `otherUserId` variable in Postman to a valid user ID

3. **Test Data**: Some tests may fail if required data doesn't exist. Create the necessary data first:
   - Create a user before testing user profile
   - Create a conversation before testing messages
   - Send a message before testing reactions

## Troubleshooting

1. **Authentication Errors**:

   - Check if your token is valid and not expired
   - Verify that the Firebase project matches your backend configuration

2. **404 Errors**:

   - Ensure the endpoint path is correct
   - Check if your server is running

3. **Permission Errors**:
   - Verify that you're using the correct token
   - Check if the authenticated user has permission for the requested action
